<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
	xmlns:activiti="http://activiti.org/bpmn" targetNamespace="http://www.bpmnwithactiviti.org/multiinstance">

	<process id="decisionProcess" name="Decision making process">
		<startEvent id="theStart" activiti:formKey="decisionItem.form" />
		<sequenceFlow sourceRef="theStart" targetRef="createAssigneeList" />
		<serviceTask id="createAssigneeList" activiti:class="org.bpmnwithactiviti.chapter10.multiinstance.CreateAssigneeList" />
		<sequenceFlow sourceRef="createAssigneeList" targetRef="decisionSubProcess"/>
		<subProcess id="decisionSubProcess">
			<multiInstanceLoopCharacteristics isSequential="false" 
		     		activiti:collection="assigneeList" activiti:elementVariable="assignee" >
		    	<completionCondition>${nrOfCompletedInstances/nrOfInstances > 0.5 }</completionCondition>
		  	</multiInstanceLoopCharacteristics>
			<startEvent id="theStartSubProcess" />
			<sequenceFlow sourceRef="theStartSubProcess" targetRef="decisionTask" />
			<userTask id="decisionTask" name="Decision task" activiti:assignee="${assignee}" />
			<sequenceFlow sourceRef="decisionTask" targetRef="gatherDecisionVote" />
			<serviceTask id="gatherDecisionVote" activiti:class="org.bpmnwithactiviti.chapter10.multiinstance.AddDecisionVote" />
			<sequenceFlow sourceRef="gatherDecisionVote" targetRef="theEndSubProcess" />
			<endEvent id="theEndSubProcess" />
		</subProcess>
		<sequenceFlow sourceRef="decisionSubProcess" targetRef="outcomeTask" />
		<serviceTask id="outcomeTask" activiti:class="org.bpmnwithactiviti.chapter10.multiinstance.PublishVotePoll" />
		<sequenceFlow sourceRef="outcomeTask" targetRef="theEnd" />
		<endEvent id="theEnd" />
	</process>
</definitions>